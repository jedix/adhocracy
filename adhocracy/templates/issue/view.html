<%inherit file="/template.html" />
<%namespace name="components" file="/components.html"/>
<%namespace name="comment_tiles" file="/comment/tiles.html"/>

<%def name="title()">${c.issue.label}</%def>

<%def name="breadcrumbs()">${h.breadcrumbs(c.issue)|n}</%def>

<div class="tile issue title">
	<div class="sidebar">
		<div class="tile boxed">
			<div class="inner_boxed">
				${h.user_link(c.issue.creator, scope=c.issue)|n} 
				${h.relative_time(c.issue.create_time)|n}
			</div> 
		</div>
	</div>
	
	<div class="logo">
		<img src="/img/icons/issue_48.png"/>
	</div>
	
	<div class="base">
		<h1>${c.issue.label}</h1>
		&nbsp;
	</div>
			
	<div class="meta rightmeta">		
		%if c.tile.can_delegate and not c.tile.has_overridden:
			<a class="button add" href="/delegation/create?scope=${c.issue.id}">${_("delegate")}</a>
		%endif
		
		%if c.tile.can_edit:
			<a class="button edit" href="/issue/edit/${c.issue.id}">${_("edit")}</a>
		%endif
					
		%if c.tile.can_delete:
			<a class="button delete" href="/issue/delete/${c.issue.id}?${h.url_token()}">${_("delete")}</a>
		%endif
		
		${components.watch(c.issue, '/issue/%s' % str(c.issue.id))}
		<a href="/issue/${c.issue.id}.rss" class="button edit"><img src='/img/rss.png' /> ${_("subscribe")}</a>
	</div>
	
	<div style="clear: both;"></div>
</div>

<div style="clear: both;"></div>

%if c.issue.comment:
	${tiles.comment.full(c.issue.comment, recurse=False, collapse=False)}
%endif
<br/>	

<div class="top_actions">
	%if c.tile.can_create_proposal:
		<a class="button add" href="/proposal/create?issue=${c.issue.id}">${_("new proposal")}</a>
	%endif	
</div>
 
<h2><img src="/img/icons/proposal_20.png" class="cd" /> ${_("Proposals")}</h2>
<div class="sidebar">
	%if h.has_permission("vote.cast"):
	<div class="tile">
		${components.delegation_sidebar(c.issue)}
	</div>
	%endif
</div>
<div class="mainbar">

%if not len(c.issue.proposals):
	<span class="infobox">${_("Proposals solve some or all of the problems described by this issue. A proposal can be <b>discussed and voted</b> upon.")|n}</span>
%else:
	<div class="table">
		${c.proposals_pager.here()}
	</div>
%endif

</div>




<div style="clear: both;"></div>

<h2><img src="/img/icons/discuss_20.png" class="cd" /> ${_("Discussion")}</h2>
%if c.tile.comment_tile.can_reply:
	<div class="comment">
		${comment_tiles.create_form(c.issue.comment, c.issue)}
	</div>
%elif not c.issue.comment_count():
	<div class="infobox">
		${_("No comments were made yet.")}
	</div>
%endif
%for (reply, reply_tile) in c.tile.comment_tile.replies():
	${tiles.comment.full(reply, recurse=True)}
%endfor

