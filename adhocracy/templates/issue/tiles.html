<%namespace name="components" file="/components.html"/>

<%def name="row(tile, issue)">
	<div class="tile">
		<div class="logo">
			<img src="/img/icons/issue_32.png" />
		</div>
		<div class="base">
			<h3><a class="link" href="${h.entity_url(issue)}">${issue.label}</a></h3>
			<!--span class="sparkline" title="${h.entity_url(issue, member='activity', format='sline')}"></span-->
			<div class="meta noclear">
				<img src="/img/icons/proposal_16.png" /> 
				${ungettext("%s proposal", "%s proposals", len(issue.proposals)) % len(issue.proposals)}
				&middot;
				<img src="/img/icons/discuss_16.png" /> 
				${ungettext("%s comment", "%s comments", issue.comment_count()) % issue.comment_count()},
				${_("latest <b>%s</b>") % h.relative_time(tile.latest_revision_time)|n}&nbsp;
			</div>
		</div>
	</div>
</%def>


<%def name="header(tile, issue, active)">
	<div class="top_actions title">
		%if tile.can_delegate:
			<a class="button add" href="/delegation/new?scope=${issue.id}">${_("delegate")}</a>
		%endif
		
		${components.watch(issue)}
		${h.rss_button(issue)|n}
	</div>
	
	<h1 class="page_title"><img src="/img/icons/issue_24.png" class="cd" /> ${issue.label}</h1>
	
	<div class="panel ${active}">
		<ul class="menu">
			<li><a href="${h.entity_url(issue, member='activity')}" 
				class="activity">${_("Activity")}</a></li>
			<li><a href="${h.entity_url(issue, member='discussion')}" 
				class="discussion">${_("Discussion")} (${issue.comment_count(recurse=False)})</a></li>
			<li><a href="${h.entity_url(issue, member='proposals')}" 
					class="proposals">${_("Proposals")} (${len(issue.proposals)}) 
					<img src="/img/arrows/panel_expand.png" /></a>
				<ul>
				%for proposal in issue.proposals[:10]:
					<li>${h.delegateable_link(proposal)|n}</li>
				%endfor
				</ul></li>
			%if c.instance.allow_delegate:
				<li><a href="${h.entity_url(issue, member='delegations')}" 
					class="delegations">${_("Delegations")} (${len(issue.current_delegations())})</a></li>
			%endif
		</ul>
		<div class="info">
			<div class="meta">
				${h.user_link(issue.creator, scope=issue)|n} 
				&middot; ${h.relative_time(issue.create_time)|n}
			</div>
		</div>
	</div>
</%def>
