<%inherit file="root.html" />
<%namespace name="model" module="adhocracy.model"/>
<%namespace name="components" file="/components.html"/>


<!DOCTYPE html>
<html>
<head>
	${self.head()}
</head>
<body lang="${c.locale.language}">
<div id="frame">
	<div id="globalheader"><div class="headerbox">
		<div id="account">
			%if c.user:
				<strong>
					<a class="user_name ttip" title="${_('Your profile')}" href="${h.entity_url(c.user)}">
						<img width="16" height="16" src="${h.user.icon_url(c.user, size=16)|n}"> ${c.user.name}
					</a>
				</strong>
				
				%if can.user.vote():
					%if c.instance.allow_adopt: 
						<a class="ttip" title="${_('Your voting record')}" 
						   href="${h.entity_url(c.user, member='votes')}">${_("Votes")}</a>
					%endif
					%if c.instance.allow_delegate:
						<a class="ttip" title="${_('Your delegation balance')}" 
						   href="${h.entity_url(c.user,member='delegations')}">${_("Delegations")}</a>
					%endif
				%endif
				%if c.instance:
					<a class="ttip" title="${_('Items you are watching')}" 
						 href="${h.entity_url(c.user, member='watchlist')}">${_("Watchlist")}</a>
				%endif
				<a class="ttip" title="${_('Settings such as language, passwords, etc.')}" 
				   href="${h.entity_url(c.user, member='edit')}">${_("Settings")}</a>
				<a class="ttip" title="${_('Sign out')}" 
				   href="/logout">${_("Logout")}</a>
			%else:
				<a href="/login">${_("Login")}</a> 
				<a href="/register">${_("Register")}</a>	
			%endif
		</div>
		<div id="navigation">
			<a href="${h.base_url(None)}">
				<img src="/img/header_link.png" alt="${h.site.name()}"/>
			</a> 
			<a class="ttip" title="${_('All instances')}" 
			   href="${h.base_url(None, path='/instance')}">${_("Instances")}</a>
			%if h.has_permission("global.admin"):
				<a href="/admin/permissions?${h.url_token()}">${_("Permissions")}</a>
				<a href="/event/all">${_("Events")}</a>
			%endif
			<div class="help">
				<a href="${h.base_url(None, path='/static/help.html')}">${_("Help")}</a>
			</div>
		</div>
	</div></div>
	
	%if c.instance:
	    <div id="instanceheader"><div class="headerbox ${c.active_controller}">
	    <a href="${h.base_url(c.instance)}" id="logo">
			<img src="/instance/${c.instance.key if c.instance else '_def'}_48x48.png" />
		</a>
		<div id="menu">
			<ul>
				<li><a class="instance ttip" title="${_('Instance home page')}" 
					     href="${h.entity_url(c.instance)}">${_("Home")}</a></li>
				%if c.instance.use_norms:
				    <li><a class="page ttip" title="${_('Norm pages')}" 
         			       href="/page">${_("Norms")}</a></li>
         		%endif
				<li><a class="proposal ttip" title="${_('Show all proposals')}" 
					     href="/proposal">${_("Proposals")}</a></li>
				<li><a class="user ttip" title="${_('All members of this instance')}" 
					     href="/user">${_("Members")}</a></li>
			</ul>
		</div>
		
		<form id="searchform" action="/search" method="GET">
		<label id="searchlabel" for="serp_q" class="armhint">${_("Search")}</label>
		<input id="search" name="serp_q" class="armlabel" autocomplete="off" />	
		</form>
	</div></div>
	%endif
	
	<div id="page">
		<div id="breadcrumbs">
			${self.breadcrumbs()}
		</div>	
		<% messages = h.flash.pop_messages() %>
		%if messages:
		<div id="flash_messages">
			<ul>
			%for message in messages:
	    		<li>${message}</li>
	    	%endfor
			</ul>
		</div>
		%endif
	
		<div class="content">
			${self.body()}
			<div style="clear: both;"></div>
		</div>
	</div>
</div>

<div id="footer">
	<div id="links">
		<div id="license">
			<a class="nolink" href="http://wiki.liqd.net/Adhocracy">
				<img alt="Adhocracy" src="/img/footer_logo.png" />
			</a>
			<br/>
			<a class="nolink" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/de/">
				<img alt="Creative Commons License" src="http://i.creativecommons.org/l/by-sa/3.0/de/80x15.png" />
			</a>
			<a class="nolink" rel="license" href="http://www.opendefinition.org/">
				<img alt="Open Definition" src="http://m.okfn.org/images/ok_buttons/oc_80x15_blue.png" />
			</a>
			<br/>
			<code>${_("v. %s") % lib.version.get_version()}</code>
		</div>
		<ul>
			<li><strong>${_("liqd.net")}</strong></li>
			<li><a href="/static/codex.html">${_("code of conduct")}</a></li>
			<li><a href="/static/terms.html">${_("terms and conditions")}</a></li>
			<li><a href="/static/privacy.html">${_("privacy")}</a></li>
			<li><a href="/static/imprint.html">${_("imprint")}</a></li>
		</ul>
		<ul>
			<li><strong>${_("adhocracy")}</strong></li>
			<li><a href="http://wiki.liqd.net/Adhocracy">${_("general info")}</a></li>
			<li><a href="http://api.liqd.net/">${_("api documentation")}</a></li>
			<li><a href="http://trac.adhocracy.de/">${_("source code")}</a></li>
			<li><a href="/static/team.html">${_("team")}</a></li>
		</ul>
		<ul>
			<li><strong>${_("liqd e.V.")}</strong></li>
			<li><a href="/static/about.html">${_("what is liquid democracy")}</a></li>
			<li><a href="http://wiki.liqd.net">${_("theory wiki (de)")}</a></li>
			<li><a href="http://blog.liqd.net">${_("liqd blog (de)")}</a></li>
			<li><a href="http://lists.liqd.net/cgi-bin/mailman/listinfo/announce">${_("mailing list")}</a></li>
		</ul>
	</div>
</div>

%if not c.debug:
    <%include file="piwik.html"/>

    <script type="text/javascript">
    var uservoiceOptions = {
      /* required */
      key: 'liqd',
      host: 'liqd.uservoice.com', 
      forum: '60515',
      showTab: true,  
      /* optional */
      alignment: 'right',
      background_color:'#336699', 
      text_color: 'white',
      hover_color: '#000',
      lang: '${c.locale.language}'
    };

    function _loadUserVoice() {
      var s = document.createElement('script');
      s.setAttribute('type', 'text/javascript');
      s.setAttribute('src', ("https:" == document.location.protocol ? "https://" : "http://") + "cdn.uservoice.com/javascripts/widgets/tab.js");
      document.getElementsByTagName('head')[0].appendChild(s);
    }
    _loadSuper = window.onload;
    window.onload = (typeof window.onload != 'function') ? _loadUserVoice : function() { _loadSuper(); _loadUserVoice(); };
    </script>
%endif

</body>
</html>
