<%namespace name="model" module="adhocracy.model"/>
<%namespace name="components" file="/components.html"/>

<%def name="title()">${_("No Title")}</%def>
<%def name="page_title()"><h1>${self.title()}</h1></%def>
<%def name="breadcrumbs()">&nbsp;</%def>
<%def name="contextbox()">&nbsp;</%def>

<%def name="page_actions()"></%def>
<%def name="page_actions_bar()">
	<div id="page_actions">
		${self.page_actions()}
	</div>
</%def>

<%def name="print_meta()">
	%for key, value in c.html_meta.items():
		<meta name="${key}" content="${value}" />
	%endfor
</%def>

<%def name="print_link()">
	%for link in c.html_link:
		<link rel="${link['rel']}" type="${link['type']}" title="${link['title']}" href="${link['href']}" />
	%endfor
</%def>


<!DOCTYPE html>
<html>
<head>
	<title>${self.title()} - 
		   	%if c.instance:
				 ${c.instance.label} 
		   	%endif
			${config.get('adhocracy.site.name')}</title>
	<link href="/style/base.css" rel="stylesheet" type="text/css" />
	<link href="/style/site.css" rel="stylesheet" type="text/css" />
	<link media="only screen and (max-device-width: 480px)" href="/style/iphone.css" type="text/css" rel="stylesheet" />
	<link rel="stylesheet" href="/style/print.css" type="text/css" media="print" />
	<link href='/favicon.ico' rel='shortcut icon' type='image/x-icon' />
	${print_link()}
	
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	${print_meta()}
	
	%if c.canonical_url:
		<link rel="canonical" href="${c.canonical_url}" />
	%endif
	
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
	<script type="text/javascript" src="/js/jquery.autocomplete.min.js"></script>	
	<script type="text/javascript" src="/js/jquery.cookie.js"></script>
	<script type="text/javascript" src="/js/jquery.timeago.js"></script>
	<script type="text/javascript" src="/js/jquery.sparkline.js"></script>
	<script type="text/javascript" src="/js/jquery.timeago.${c.locale.language}.js"></script>
	<script type="text/javascript" src="/js/adhocracy.js"></script>
</head>
<body>
<div id="frame">
	<div id="header">
		<div id="center">
			<ul id="account">
			%if not c.user:
				<li class="${'last' if c.instance else ''}"><a href="/login">${_("sign in")}</a>
				%if c.instance:
					${_("to")}
				%endif
				</li>
			%else:
				<li class="${'last' if c.instance else ''}"><img src="${h.gravatar_url(c.user, size=16)|n}">
				<a class="user_name" href="${h.entity_url(c.user)}">${c.user.name}</a>
				%if c.instance:
					${_("in")}
				%endif
				</li>
			%endif
			%if c.instance:
				<li>
					<a href="${h.entity_url(c.instance)}">${c.instance.label}</a>
					<ul>
						%for i in h.context_instances():
							<li><a href="${h.entity_url(i)}">${i.label}</a></li>
						%endfor
						<li><a href="${h.instance_url(None, path='/adhocracies')}">${_("other...")}</a></li>
					</ul>
				</li>
			%endif
			%if not c.user:	
				<li class="last"><a href="/register">${_("create an account")|n}</a></li>
			%else:
				%if c.instance and not c.user.is_member(c.instance):
					<li><a class="join" 
						href="${h.entity_url(c.instance, member='join')}?${h.url_token()}">${_("join %s") % c.instance.label}</a></li>	
				%endif 
				
				%if h.has_permission("vote.cast"):
					<li><a href="${h.entity_url(c.user, member='votes')}">${_("votes")}</a></li>
					<li><a href="${h.entity_url(c.user, member='delegations')}">${_("delegations")}</a></li>						
				%endif
				<li><a href="${h.entity_url(c.user, member='edit')}">${_("settings")}</a></li>
				<li class="last"><a href="/logout">${_("logout")}</a></li>
			%endif
			</ul>
			<a href="${h.entity_url(c.instance) if c.instance else '/'}"><img id="logo" src="/instance/${c.instance.key if c.instance else '_def'}_64x64.png" /></a>
			<div id="menu">
				<ul>
					%if not c.instance:
						<li><a href="/">${_("Home")}</a></li>
						<li><a href="/adhocracies">${_("Adhocracies")}</a></li>
					%endif
					%if c.instance:
						<li><a href="/issue">${_("Issues")}</a></li>
						<li><a href="/proposal">${_("Proposals")}</a></li>
					%endif
					%if h.has_permission("global.admin"):
						<li><a href="/admin/permissions">${_("Admin")}</a></li>
					%endif
					%if c.instance:
						<li><a href="/user">${_("Members")}</a></li>
					%endif
					%if not c.instance:
						<li><a href="/user">${_("All Users")}</a></li>
					%endif
				</ul>
			</div>
			
			<form id="searchform" action="/search" method="GET">
			<label id="searchlabel" for="serp_q" class="armhint">${_("Search")}</label>
			<input id="search" name="serp_q" class="armlabel" autocomplete="off" />	
			</form>
		</div>
	</div>
	<%def name="page()">
	<div id="page">
		<div id="breadcrumbs">
			${self.breadcrumbs()}
		</div>	
		<% messages = h.flash.pop_messages() %>
		%if messages:
		<div id="flash_messages">
			<ul>
			%for message in messages:
	    		<li>${message}</li>
	    	%endfor
			</ul>
		</div>
		%endif
	
		<div class="content">
			${self.body()}
		</div>
	</div>
	</%def>
	
	<%def name="tpl_page()">
		${self.page()}
	</%def>
	
	${self.tpl_page()}
</div>

<div id="footer">
	<div id="links">
		<div id="license">
			<a class="nolink" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/de/">
				<img alt="Creative Commons License" src="http://i.creativecommons.org/l/by-sa/3.0/de/80x15.png" />
			</a>
		</div>
		
		<a class="nolink" href="http://liqd.net"><img id="button" src="/img/liqd_ev.png"/></a>
		<a class="nolink" href="http://wiki.liqd.net/Adhocracy">${_("adhocracy &middot; liquid democracy platform")|n}</a><br/>
		<a href="/page/about.html">${_("about")}</a> &middot;
		<a href="http://wiki.liqd.net/Adhocracy/Handbuch">${_("help")}</a> &middot; 
		<a href="http://trac.adhocracy.de/newticket">${_("report a problem")}</a> &middot;
		<a href="/page/privacy.html">${_("privacy")}</a> &middot; 
		<a href="/page/imprint.html">${_("imprint")}</a> &middot;
		${c.lib.get_version()}
	</div>
</div>
</body>
</html>