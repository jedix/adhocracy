<%namespace name="model" module="adhocracy.model"/>
<%namespace name="components" file="/components.html"/>

<%def name="title()">${_("No Title")}</%def>

<%def name="page_title()"><h1>${self.title()}</h1></%def>

<%def name="breadcrumbs()">&nbsp;</%def>

<%def name="contextbox()">&nbsp;</%def>

<%def name="page_actions()"></%def>

<%def name="page_actions_bar()">
	<div id="page_actions">
		${self.page_actions()}
	</div>
</%def>

<%def name="print_meta()">
	%for key, value in c.html_meta.items():
		<meta name="${key}" content="${value}" />
	%endfor
</%def>

<%def name="print_link()">
	%for link in c.html_link:
		<link rel="${link['rel']}" type="${link['type']}" title="${link['title']}" href="${link['href']}" />
	%endfor
</%def>

<!DOCTYPE html>
<html>
<!--

                         ''~``
                        ( o o )
+------------------.oooO--(_)--Oooo.-------------------+
|                                                      |
| Ok, here's the thing: Adhocracy does store sensitive | 
| information but we know it's not 100% secure. So if  |
| you find vulnerabilities, report them to us and we   |
| will send you a free T-shirt: "I hacked democracy".  |
| Deal?                                                | 
|                    .oooO                             |
|                    (   )   Oooo.                     |
+---------------------\ (----(   )---------------------+
                       \_)    ) /
                             (_/

-->
<head>
	<title>${self.title()} - 
		   	%if c.instance:
				 ${c.instance.label} 
		   	%endif
				${h.site_name()}
	</title>
	<link href="/style/base.css" rel="stylesheet" type="text/css" />
	<link href="/style/site.css" rel="stylesheet" type="text/css" />
	<link media="only screen and (max-device-width: 480px)" href="/style/iphone.css" type="text/css" rel="stylesheet" />
	<link rel="stylesheet" href="/style/print.css" type="text/css" media="print" />
	<link href='/favicon.ico' rel='shortcut icon' type='image/x-icon' />
	${print_link()}
	
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	${print_meta()}
	
	%if c.canonical_url:
		<link rel="canonical" href="${c.canonical_url}" />
	%endif
	
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
	<script type="text/javascript" src="/js/jquery.autocomplete.min.js"></script>	
	<script type="text/javascript" src="/js/jquery.qtip.min.js"></script>
	<script type="text/javascript" src="/js/jquery.timeago.js"></script>
	<script type="text/javascript" src="/js/jquery.timeago.${c.locale.language}.js"></script>
	<script type="text/javascript" src="/js/adhocracy.js"></script>
	
</head>
<body>
<div id="frame">
	<div id="header">
		<div id="center">
			<ul id="account">
			%if not c.user:
				<li class="${'last' if c.instance else ''}"><a href="/login">${_("sign in")}</a>
				%if c.instance:
					${_("to")}
				%endif
				</li>
			%else:
				<img src="${h.gravatar_url(c.user, size=16)|n}">
				<li class="${'last' if c.instance else ''}">
				<a class="user_name" href="${h.entity_url(c.user)}">${c.user.name}</a> 
				<img src="/img/icons/adown.png" alt="^"/>
				<ul>
					%if c.instance and h.has_permission("vote.cast"):
						%if c.instance.allow_adopt: 
							<li><a href="${h.entity_url(c.user, member='votes')}">${_("votes")}</a></li>
						%endif
						%if c.instance.allow_delegate:
							<li><a href="${h.entity_url(c.user, member='delegations')}">${_("delegations")}</a></li>
						%endif
					%endif
					<li><a href="${h.entity_url(c.user, member='watchlist')}">${_("watchlist")}</a></li>						
					<li><a href="${h.entity_url(c.user, member='edit')}">${_("settings")}</a></li>
				</ul>
				%if c.instance:
					${_("in")}
				%endif
				</li>
			%endif
				%if c.user or c.instance:
				<li>
					%if c.instance:
					<a href="${h.entity_url(c.instance)}">${c.instance.label}</a>
					%elif c.user:
					<a href="${h.entity_url(c.user, member='instances')}">${_("your instances")}</a>
					%endif
					<img src="/img/icons/adown.png" alt="^"/>
					<ul>
						%for i in h.context_instances():
							<li><a href="${h.entity_url(i)}">${i.label}</a></li>
						%endfor
						<li><a href="${h.instance_url(None, path='/instance')}">${_("other...")}</a></li>
					</ul>
				</li>
			%endif
			%if not c.user:	
				<li class="last"><a href="/register">${_("create an account")|n}</a></li>
			%else:
				%if c.instance and not c.user.is_member(c.instance):
					<li><a class="join" 
						href="${h.entity_url(c.instance, member='join')}?${h.url_token()}">${_("join %s") % c.instance.label}</a></li>	
				%endif 
				
				%if h.has_permission("global.admin"):
					<li><a href="/admin/permissions?${h.url_token()}">${_("perms")}</a></li>
					<li><a href="/event/all">${_("log")}</a></li>
				%endif
				<li class="last"><a href="/logout">${_("logout")}</a></li>
			%endif
			</ul>
			<a href="${h.instance_url(c.instance)}"><img id="logo" src="/instance/${c.instance.key if c.instance else '_def'}_64x64.png" /></a>
			<div id="menu">
				<ul>
					%if not c.instance:
						<li><a href="/">${_("Home")}</a></li>
						<li><a href="/instance">${_("Instances")}</a></li>
					%endif
					%if c.instance:
						<li><a href="${h.entity_url(c.instance)}">${_("Home")}</a></li>
						<li><a href="${h.entity_url(c.instance, member='activity')}" 	
							class="activity">${_("Activity")}</a></li>
						<li><a href="/proposal">${_("Proposals")}</a></li>
						<!--li><a href="/tag">${_("Tags")}</a></li-->
						<!--li><a href="/adopted" class="adopted">${_("Outcomes")}</a></li-->
					%endif
					%if c.instance:
						<li><a href="/user">${_("Members")}</a></li>
					%endif
					%if not c.instance:
						<li><a href="/user">${_("All Users")}</a></li>
					%endif
				</ul>
			</div>
			
			<form id="searchform" action="/search" method="GET">
			<label id="searchlabel" for="serp_q" class="armhint">${_("Search")}</label>
			<input id="search" name="serp_q" class="armlabel" autocomplete="off" />	
			</form>
		</div>
	</div>
	
	<div id="page">
		<div id="breadcrumbs">
			${self.breadcrumbs()}
		</div>	
		<% messages = h.flash.pop_messages() %>
		%if messages:
		<div id="flash_messages">
			<ul>
			%for message in messages:
	    		<li>${message}</li>
	    	%endfor
			</ul>
		</div>
		%endif
	
		<div class="content">
			${self.body()}
			<div style="clear: both;"></div>
		</div>
	</div>
</div>

<div id="footer">
	<div id="links">
		<div id="license">
			<a class="nolink" href="http://wiki.liqd.net/Adhocracy">
				<img alt="Adhocracy" src="/img/footer_logo.png" />
			</a>
			<br/>
			<a class="nolink" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/de/">
				<img alt="Creative Commons License" src="http://i.creativecommons.org/l/by-sa/3.0/de/80x15.png" />
			</a>
			<a class="nolink" rel="license" href="http://www.opendefinition.org/">
				<img alt="Open Definition" src="http://m.okfn.org/images/ok_buttons/oc_80x15_blue.png" />
			</a>
			
		</div>
		
		<ul>
			<li><strong>${_("adhocracy")}</strong></li>
			<li><a href="/static/about.html">${_("what is liquid democracy")}</a></li>
			<li><a href="http://wiki.liqd.net/Adhocracy">${_("adhocracy software")}</a></li>
			<li><a href="/static/codex.html">${_("code of conduct")}</a></li>
			<li><a href="/static/terms.html">${_("terms and conditions")}</a></li>
			<li><a href="/static/privacy.html">${_("privacy")}</a></li>
		</ul>
		<ul>
			<li><strong>${_("liqd e.V.")}</strong></li>
			<li><a href="http://wiki.liqd.net">${_("theory wiki (de)")}</a></li>
			<li><a href="http://blog.liqd.net">${_("liqd blog (de)")}</a></li>
			<li><a href="http://twitter.com/liqd_net">${_("twitter")}</a></li>
			<li><a href="http://lists.liqd.net/cgi-bin/mailman/listinfo/announce">${_("mailing list")}</a></li>
			<li><a href="/static/imprint.html">${_("imprint")}</a></li>
		</ul>
	</div>
</div>


%if config.get('piwik.site'):
<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "${config.get('piwik.site')}" : "${config.get('piwik.site')}");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", ${config.get('piwik.id')});
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="${config.get('piwik.site')}piwik.php?idsite=${config.get('piwik.id')}" style="border:0" alt=""/></p></noscript>
<!-- End Piwik Tag -->
%endif


<script type="text/javascript" charset="utf-8">
  var is_ssl = ("https:" == document.location.protocol);
  var asset_host = is_ssl ? "https://s3.amazonaws.com/getsatisfaction.com/" : "http://s3.amazonaws.com/getsatisfaction.com/";
  document.write(unescape("%3Cscript src='" + asset_host + "javascripts/feedback-v2.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript" charset="utf-8">
  var feedback_widget_options = {};
  feedback_widget_options.display = "overlay";  
  feedback_widget_options.company = "liqd";
  feedback_widget_options.placement = "right";
  feedback_widget_options.color = "#222";
  feedback_widget_options.style = "problem";
  var feedback_widget = new GSFN.feedback_widget(feedback_widget_options);
</script>

</body>
</html>