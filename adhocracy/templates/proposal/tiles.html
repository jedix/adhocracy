<%namespace name="components" file="/components.html"/>
<%namespace name="state" file="/poll/state.html"/>

<%def name="row(tile, proposal)">
	<div class="tile">
		<div class="logo">
			%if tile.state.adopted:
				<img src="/img/icons/proposal_adopted_32.png" />
			%elif tile.state.polling:
				<img src="/img/icons/vote_32.png" />
			%else:
				<img src="/img/icons/proposal_32.png" />
			%endif
		</div>
		<div class="base">
			<h3><a class="link" href="${h.instance_url(proposal.instance, path='/proposal/%s' % proposal.id)}">${proposal.label}</a></h3>
			<!-- div class="text">
				${tile.tagline}
			</div -->
			<div class="meta noclear">				
				%if tile.state.polling:
					${_("<b>%s</b> votes,") % len(tile.state.tally)|n}
					${_("<b>%s%%</b> approval") % int(tile.state.tally.rel_for * 100)|n}
					&middot; 
				%endif
				<img src="/img/icons/discuss_16.png" /> 
				${ungettext("%s comment", "%s comments", proposal.comment_count()) % proposal.comment_count()},
				${_("latest <b>%s</b>") % h.relative_time(tile.latest_revision_time)|n}&nbsp;
			</div>
		</div>
	</div>
</%def>

<%def name="alternative(proposal=None, options=None, prototype=False, checked=False)">
	<tr class="alternative ${'prototype' if prototype else ''}">
		<td>
		%if options:
			</td>
			<td>
			<select name="alternative">
			%if not proposal:
				<option value="none">${_("(Select a proposal)")}</option>
			%endif
			%for current in options:
				<option value="${current.id}" ${"selected='selected'" if proposal==current else ''}>
					${current.label}
				</option>
			%endfor
			</select>
		%elif proposal:
			<input type="checkbox" name="alternative" value="${proposal.id}" 
			       ${"checked='checked'" if checked else ''} />
			</td>
			<td>
			${h.delegateable_link(proposal)|n}
		%endif
		</td>
	</tr>
</%def>


<%def name="sidebar(tile, proposal)">
	%if proposal.adopt_poll: 
		${tiles.poll.booth(proposal.adopt_poll)}
	%endif
	${state.checklist(tile.state)|n}
	${tiles.delegation.sidebar(proposal)}
</%def>


<%def name="header(tile, proposal, active)">
	<div class="top_actions title">
		%if tile.can_delegate and not tile.has_overridden:
			<a class="button title add" 
			    href="/delegation/new?scope=${proposal.id}">${_("delegate")}</a>
		%endif
		
		%if proposal.can_adopt():
			<a class="button title add" 
				href="${h.entity_url(proposal, member='ask_adopt')}">${_("call a vote")}</a>
		%elif c.user and not proposal.has_canonicals():
			<a class="button title inactive htwarn" title="${_('The proposal cannot be voted upon since it does not have any provisions yet.')}">${_("call a vote")}</a>
		%endif
		
		%if tile.can_edit:
			<a class="button title edit" href="${h.entity_url(proposal, member='edit')}">${_("edit")}</a>
		%endif
						
		%if tile.can_delete:
			<a class="button title delete" 	
				href="${h.entity_url(proposal)}?_Method=DELETE&${h.url_token()}">${_("delete")}</a>
		%endif
		
		${components.watch(proposal, '/proposal/%s' % str(proposal.id))}
		${h.rss_button(proposal)|n}
	</div>
	
	<h1 class="page_title"><img src="/img/icons/proposal_24.png" class="cd" /> ${proposal.label}</h1>
	
	<div class="panel ${active}">
		<div class="menu">
			<a href="${h.entity_url(proposal, member='activity')}" 	
				class="activity">${_("Activity")}</a>
			<a href="${h.entity_url(proposal)}" class="goal">${_("Goal")}</a>
			<a href="${h.entity_url(proposal, member='canonicals')}" 
				class="canonicals">${_("Implementation")} (${len(proposal.canonicals)})</a>
			%if tile.poll:
				<a href="/poll/${tile.poll.id}/votes" class="votes">${_("Votes")} 
					(${len(tile.state.tally)})</a>
			%endif
			<a href="${h.entity_url(proposal, member='delegations')}"
			   class="delegations">${_("Delegations")} (${len(proposal.current_delegations())})</a>
			<span class="submenu">
				<a href="${h.entity_url(proposal, member='alternatives')}"
			   	class="alternatives">${_("Alternatives")} (${len(proposal.current_alternatives())}) 
					<img src="/img/arrows/panel_expand.png" /></a>
				<ul>
				%for proposal in proposal.current_alternatives()[:10]:
					<li>${h.delegateable_link(proposal)|n}</li>
				%endfor
				</ul>
			</span>
		</div>
		<div class="info">
			<div class="meta">
				${h.user_link(proposal.creator, scope=proposal)|n} 
				&middot; ${h.relative_time(proposal.create_time)|n}
				&middot; ${_("in %s") % h.delegateable_link(proposal.issue)|n}
			</div>
		</div>
	</div>
</%def>
