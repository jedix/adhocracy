<%namespace name="components" file="/components.html"/>

<%def name="row(tile, user)">
	<div class="tile vcard">
		<div class="logo">
			<img src="${h.gravatar_url(user, size=32)|n}" />
		</div>
		<div class="base">
			<h3><a class="link fn nickname" href="${h.entity_url(user)}">${user.name}</a></h3>
			<div class="meta noclear">
				<%
				mem = user.instance_membership(c.instance)
				%>
				%if mem:
					<span class="role">${_(tile.instance_group.group_name)}</span> &middot;
					${_("joined %s") % h.relative_time(mem.create_time)|n}
				%else: 
					${_("signed up %s") % h.relative_time(user.create_time)|n}
				%endif
			</div>
		</div>
	</div>
</%def>

<%def name="header(tile, user, active)">
	<div class="top_actions title vcard">
		%if can.user.edit(user):
			<a class="button edit" href="${h.entity_url(user, member='edit')}">${_("edit")}</a>
		%endif
		
		%if can.user.supervise(user):
			%for group_code in c.model.Group.INSTANCE_GROUPS:
				%if group_code != tile.instance_group.code:
					<a class="button admin" href="${h.entity_url(user, member='groupmod')}?to_group=${group_code}&${h.url_token()}">
						${_("make %s") % _(c.model.Group.by_code(group_code).group_name)}</a>
				%endif
			%endfor
			
			%if c.user and c.instance and c.user == c.page_user and can.instance.leave(c.instance):
				<a class="button delete ttip" title="${_('Resign from this instance.')}" 
					href="${h.entity_url(c.instance, member='ask_leave')}">${_("leave instance")}</a> 
			%endif
			
			<a class="button delete" 
				href="${h.entity_url(user, member='kick')}?${h.url_token()}">${_("kick")}</a>
		%endif
		
		%if c.user and user != c.user:
			${components.watch(user)}
			${h.rss_button(user)|n}
		%endif
	</div>
	
	<div style="clear: both;"></div>
	<h1 class="page_title">
		<img class="logo photo" src="${h.gravatar_url(c.page_user, size=24)|n}" class="cd" alt="">
		<span class="fn nickname">${user.name}</span>
	</h1>
	
	<div class="panel ${active}">
		<ul class="menu">
			<li><a href="${h.entity_url(user)}" rel="profile url" class="activity">${_("Activity")}</a></li>
			%if c.instance:
				%if c.instance.allow_adopt:
					<li><a href="${h.entity_url(user, member='votes')}" class="votes">${_("Votes")}</a></li>
				%endif
				%if c.instance.allow_delegate:
					<li><a href="${h.entity_url(user, member='delegations')}" 
						class="delegations">${_("Delegations")} 
						(${len(user.current_agencies())})</a></li>
				%endif
				<li><a href="${h.entity_url(user, member='proposals')}" class="proposals">${_("Proposals")} 
					(${tile.num_proposals})</a></li>
				##<li><a href="${h.entity_url(user, member='comments')}" class="comments">${_("Comments")} 
				##	(${tile.num_comments})</a></li>
				
				<li><a href="${h.entity_url(user, member='watchlist')}" class="watchlist">${_("Watchlist")}
					(${user.num_watches})</a></li>
			%endif	
			<li><a href="${h.entity_url(user, member='instances')}" class="instances">${_("Instances")} 	
				(${tile.num_instances})</a></li>
		</ul>
		
		<div class="info">
			<div class="meta">
				${_("signed up %s") % h.relative_time(user.create_time)|n}
			</div>
			<% 
			grp = tile.instance_group
			%>
			%if grp:
				<span class="role">
					${"%(group)s in %(instance)s" % dict(group=_(grp.group_name), 	
													 instance=c.instance.label)}
				</span>
			%endif
		</div>
	</div>
</%def>